<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>我是如何用Node做前端国际化的 | Talking One</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="../hero.png">
    <link rel="apple-touch-icon" href="../hero.png">
    <meta name="description" content="">
    <link rel="preload" href="/talking_blog/assets/css/0.styles.80acb7a6.css" as="style"><link rel="preload" href="/talking_blog/assets/js/app.5feee785.js" as="script"><link rel="preload" href="/talking_blog/assets/js/2.2bcc5ed6.js" as="script"><link rel="preload" href="/talking_blog/assets/js/11.a017f073.js" as="script"><link rel="prefetch" href="/talking_blog/assets/js/10.19cb9432.js"><link rel="prefetch" href="/talking_blog/assets/js/12.71db85a2.js"><link rel="prefetch" href="/talking_blog/assets/js/13.2b959555.js"><link rel="prefetch" href="/talking_blog/assets/js/14.c3357cf2.js"><link rel="prefetch" href="/talking_blog/assets/js/15.e8792ca0.js"><link rel="prefetch" href="/talking_blog/assets/js/16.6de49c40.js"><link rel="prefetch" href="/talking_blog/assets/js/17.5d0127f3.js"><link rel="prefetch" href="/talking_blog/assets/js/18.a6d5a490.js"><link rel="prefetch" href="/talking_blog/assets/js/19.bc57abc5.js"><link rel="prefetch" href="/talking_blog/assets/js/20.01fd7df4.js"><link rel="prefetch" href="/talking_blog/assets/js/21.8b46e52d.js"><link rel="prefetch" href="/talking_blog/assets/js/22.cd99d19f.js"><link rel="prefetch" href="/talking_blog/assets/js/23.b9523ae9.js"><link rel="prefetch" href="/talking_blog/assets/js/3.992dbd32.js"><link rel="prefetch" href="/talking_blog/assets/js/4.41ebb6e9.js"><link rel="prefetch" href="/talking_blog/assets/js/5.43e08e50.js"><link rel="prefetch" href="/talking_blog/assets/js/6.0d51679c.js"><link rel="prefetch" href="/talking_blog/assets/js/7.0684653b.js"><link rel="prefetch" href="/talking_blog/assets/js/8.70d3001c.js"><link rel="prefetch" href="/talking_blog/assets/js/9.17495a4e.js">
    <link rel="stylesheet" href="/talking_blog/assets/css/0.styles.80acb7a6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/talking_blog/" class="home-link router-link-active"><!----> <span class="site-name">Talking One</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/talking_blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/talking_blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/talking_blog/node/" class="nav-link router-link-active">
  Node
</a></div><div class="nav-item"><a href="/talking_blog/other/" class="nav-link">
  Other
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/talking_blog/vue/" class="nav-link">
  Vue
</a></div><div class="nav-item"><a href="/talking_blog/react/" class="nav-link">
  React
</a></div><div class="nav-item"><a href="/talking_blog/node/" class="nav-link router-link-active">
  Node
</a></div><div class="nav-item"><a href="/talking_blog/other/" class="nav-link">
  Other
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span></span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/talking_blog/node/前端国际化.html" class="active sidebar-link">我是如何用Node做前端国际化的</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/talking_blog/node/前端国际化.html#封装翻译方法-指令" class="sidebar-link">封装翻译方法,指令</a></li><li class="sidebar-sub-header"><a href="/talking_blog/node/前端国际化.html#组件代理" class="sidebar-link">组件代理</a></li><li class="sidebar-sub-header"><a href="/talking_blog/node/前端国际化.html#国际化语言包的收集" class="sidebar-link">国际化语言包的收集</a></li><li class="sidebar-sub-header"><a href="/talking_blog/node/前端国际化.html#百度翻译的接入" class="sidebar-link">百度翻译的接入</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="我是如何用node做前端国际化的"><a href="#我是如何用node做前端国际化的" class="header-anchor">#</a> 我是如何用Node做前端国际化的</h1> <p>本文我们主要讲一下整个解决方案的思维，方案的核心的就是降低人工成本，使前端国际化偏向于自动化。</p> <p>在讲之前，其实还有一个问题个人觉得还是需要提一下。因为我看过很多的国际化项目，每个项目经过国际化改造之后呢，组件中原本所有的中文全部变成了$t('ts.xxxx')。当然这是国际化会产生的一个很现实的结果。改造之后，这样的代码可以说对我们的后期维护来说其实是非常的痛苦的。代码可读性直线下降。前面我说了，这是一个很现实的结果，但是这不是一个必然的结果。所以，我肯定是不会让这个结果产生的。</p> <div class="custom-block warning"><p class="custom-block-title">Question</p> <p>如何解决国际化改造之后造成代码可读性下降？</p></div> <p>废话不多说，简单的介绍一下我的思路吧。</p> <h2 id="封装翻译方法-指令"><a href="#封装翻译方法-指令" class="header-anchor">#</a> 封装翻译方法,指令</h2> <p>看到这里，其实大家就明白了我上面说的问题了。是的，我就是拿中文来做检索的。组件里的中文该怎么写还怎么写，不用改成翻译包里对应的key了。这样我们的的代码可读性就上来了。当然，我需要知道你那些中文是需要去翻译的。所以我封装了一个全局翻译的方法（$_i18n）和一个全局的翻译指令（v-ts）;</p> <p><em><strong>v-ts 主要应用于template中，$_i18n主要应用于js中</strong></em></p> <ul><li>v-ts: 该指令用以读取组件的innerText, 将innerText拿来跟语言包里的中文做对比，找出该中文对应的key，然后将找出的key传给i18n的$t方法，$t根据key做对应的翻译。v-ts也支持传入value。默认去取传入的value如果没有传value,就会去读取el的innerText。</li> <li>$_i18n: 该方法主思路跟v-ts一样，只不过v-ts是需要去读取自身el的innerText，而$_i18n函数则是依赖接收的参数，将需要翻译的中文作为参数传入。</li></ul> <p>如果你是一个对项目又深入思考的人，到这里其实你就该提出疑问了？这样呃的中文对比岂不是非常的呆板？只要中文稍微发生一点的变化岂不是就不能准确的翻译了？哪怕是多个空格，少一个标点符号，而且也不利于翻译包的复用啊，翻译包的体积也变大了，要翻译的内容也多了，这不是加大工作量了吗？</p> <p>对于这个问题我可以肯定的回答你，你的疑问都是存在的。翻译包的体积变大我可以毫不避讳的讲，是必然会增大的，所以我们要考虑如何降低语言包录入这个工作量，后面我会给出解决方案。我们先来看一下如何减少满项目的去添加我们v-ts和$_i18n；</p> <h2 id="组件代理"><a href="#组件代理" class="header-anchor">#</a> 组件代理</h2> <p>组件代理的意义在哪里？组件代理的意义其实就是为了减少我们的工作量。我们不用去针对所有中文去加翻译方法。我们只需在组件内部，将需要做翻译的字段或者插槽，属性，以及一级子组件需要做翻译的地方我们统一的添加我们的翻译方法。</p> <p>这里的组件不仅仅指的是我们自定义的组件，有时候为了方便，我们还要将我们的UI框架的组件进行代理。而且代理UI框架的组件才是最有效方法。无论你的自定义组件如何封装，只要你用到了UI框架的组件，最终都跑不过被我们代理的命运，一旦被我们代理，那么就可以植入我们封装好的$_i18n和v-ts;</p> <p>简单的上几个代理的组件来看一下效果：</p> <div class="language-vue extra-class"><pre class="language-vue"><code>// formItem组件，将所有的表单的label做翻译
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FormItem</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$listeners<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span>
      <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>label<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$attrs.label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      {{$t($_i18n($attrs.label))}}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FormItem</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> FormModel <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ant-design-vue'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'a-form-model-item'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre></div><div class="language-vue extra-class"><pre class="language-vue"><code>// 代理input组件，翻译input的placeholder;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i-input</span>
    <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>curValue<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>listeners<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>inputHandler<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">:placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>$_i18n(placeholder)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name in Object.keys($slots)<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:slot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i-input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> Input <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ant-design-vue'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'a-input'</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>我这里使用的是 <em><strong>ant-design-vue</strong></em> UI 框架。然后我们将我们代理组件注册为全局组件，并根据 <em><strong>name</strong></em> 来覆盖UI组件的原来的组件。所以name我们一般取名跟UI 框架的组件名相同，以达到覆盖的效果。</p> <p>还有很多的一些常用的组件，例如button,table等。</p> <h2 id="国际化语言包的收集"><a href="#国际化语言包的收集" class="header-anchor">#</a> 国际化语言包的收集</h2> <p>国际化翻译还有一个必然的条件，那就是国家化的语言包。上面我们谈到了语言包收集的工作量的问题。是的，如果你的项目达到一定规模的话，全部靠手动的维护，这势必是很耗时的。所以接下来要介绍的就是如果让这份工作自动化的方法。</p> <h3 id="语言包的excel导入"><a href="#语言包的excel导入" class="header-anchor">#</a> 语言包的excel导入</h3> <p>国际化的需求一般都是依赖于前端实现的，所以后段基本是不可指望的，但是我又不想一句句的手动录入。故，我们是时候另辟蹊径了。</p> <p>当我接收这份工作的时候，我拿到了一根专业翻译的语言包excel。所以我的工作就是将这份专业的语言包excel录入到项目中。嗯，这是一份十分轻松但是无趣的工作，所以从一开始对手工录入的想法我是拒绝的。既然是excel，那我们何不利用excel导入呢？将导入的文件内容进行解析，根据国际化语言包的标准生成对应的json文件，写入到项目中。</p> <p>说干就干，感谢webpack, 自带node和express,让我们省了很多事，没必要去另开一个node项目。我们就用自带的node,express来开启一份本地服务。express创建本地服务的方法我就不介绍了。</p> <p>介绍一款基于node的excel文件解析的插件***node-xlsx***;</p> <blockquote><p>npm install node-xlsx -D</p></blockquote> <p>贴一下代码，如何利用express来解析excel文件，并写入到项目本地的。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> xls <span class="token operator">=</span>  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'node-xlsx'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> resolve <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8090</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'服务启动了'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//  node服务， server.js</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/import'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 读取项目/src/lang文件夹下的ts.xlsx文件（ts.xlsx文件就是上述的国际化语言包excel文件）</span>
  <span class="token keyword">const</span> file <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'/src/lang/ts.xlsx'</span><span class="token punctuation">)</span>
  <span class="token comment">// 利用node-xlsx插件解析excel，sheetList为解析后的结果</span>
  <span class="token keyword">var</span> sheetList <span class="token operator">=</span> xls<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>

  <span class="token comment">// 判断文件夹路径是否存在</span>
  <span class="token keyword">var</span> <span class="token function-variable function">pathIsExit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">access</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建文件夹</span>
  <span class="token keyword">var</span> <span class="token function-variable function">makeDir</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      fs<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 文件写入，node的writeFile还是很优秀的，如果文件不存在，会先创建文件，然后写入，如果文件存在就向文件写入内容。</span>
  <span class="token keyword">var</span> <span class="token function-variable function">writeFile</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">path<span class="token punctuation">,</span> content</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> content<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'文件写入成功'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 将解析的excel内容转换成语言包要求的标准格式的文件</span>
  <span class="token keyword">var</span> <span class="token function-variable function">createContent</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>name<span class="token punctuation">,</span> data<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> dir_path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/src/lang/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> zn_path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir_path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/zh-CN.js</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">var</span> en_path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>dir_path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/en-US.js</span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">var</span> znJson <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">var</span> enJson <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> zn <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token keyword">var</span> en <span class="token operator">=</span> e<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>zn <span class="token operator">&amp;&amp;</span> en<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        znJson<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> zn<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\n/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        enJson<span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> en<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\\n/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> isExit <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">pathIsExit</span><span class="token punctuation">(</span>dir_path<span class="token punctuation">)</span> <span class="token comment">// 先判断文件夹是否存在</span>
    isExit <span class="token operator">||</span> <span class="token punctuation">(</span>isExit <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">makeDir</span><span class="token punctuation">(</span>dir_path<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 不存在的话就先创建文件夹</span>
    <span class="token function">writeFile</span><span class="token punctuation">(</span>zn_path<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>znJson<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 中文翻译包文件写入</span>
    <span class="token function">writeFile</span><span class="token punctuation">(</span>en_path<span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>enJson<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span> <span class="token comment">// 英文翻译包文件写入</span>
  <span class="token punctuation">}</span>
  sheetList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">createContent</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>code<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> sheetList<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>到这一步其实远远没有达到我们自动化的要求，虽然不用手动去项目中一句一句的录入了，但是excel里的翻译内容是也是需要人工的，虽然不需要我们去做，但是终归是需要人力去维护的。</p> <p>所以，如果只到这一步，我们的系统就只能算是人工 + 智能了，而非人工智能。既然如此，能用代码解决我们就绝不动手。</p> <h2 id="百度翻译的接入"><a href="#百度翻译的接入" class="header-anchor">#</a> 百度翻译的接入</h2> <p>是的，我这里就是利用百度翻译的，来做国际化的。而且百度翻译也支持多种语言的翻译，我们只要根据需求去选择对应的语言就行。</p> <p><a href="https://fanyi-api.baidu.com/doc/11" target="_blank" rel="noopener noreferrer">百度API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>；</p> <p>至于百度API接入我就不赘述了，有兴趣的自己去看看。</p> <p>那么到这里就只剩一个问题了，如何侦测哪些中文是需要做翻译的，然后利用百度翻译的API进行翻译，然后将翻译的内容写入到对应的本地文件中。</p> <p>上面，我们讲过了，利用我们封装的$_i18n和v-ts来对需要翻译的中文进行翻译，所以我们只需要做两件事。</p> <ol><li>将所有需要翻译的中文的地方全部使用$_i18n和v-ts包裹</li> <li>在$_i18n方法和ts中侦测未翻译的中文，并存储下来，然后利用百度API进行翻译。</li></ol> <p>如何侦测中文是否未翻译：就是将要翻译的中文去已经翻译好的语言包中做比对，如果未找到，那就定义为未翻译。</p> <div class="custom-block warning"><p class="custom-block-title">Question</p> <p>为什么要将未翻译的中文缓存下来，而不是直接就调用好百度API进行翻译呢？</p></div> <p>其实，这是有两个考虑：</p> <ol><li>百度API的限制，有访问频率限制，单位时间内，超过了频率将不能正确的翻译</li> <li>每次翻译完之后我们都要将翻译结果写入到文件项目中的，项目文件的变更会引起页面的热更新，如果频繁的更新，页面会一直处于闪烁的状态。</li></ol> <p>所以我们先将未翻译的中文缓存下来，然后进行批量翻译。</p> <p>然后百度翻译有时候的翻译结果并不符合翻译预期，我们需要进行纠错，所以本人另外开发一个翻译纠错的页面。针对已翻译的语言包进行修改。</p> <div class="custom-block warning"><p class="custom-block-title">Question</p> <ol><li>如何解决相同中文文案，不同页面需要不同的翻译文案的问题？</li></ol></div> <p>答案肯定是有的：简单的提示一下，类似与命名空间的实现。</p> <p>好了，本文着重的是讲解思路，如果需要了解更多详情的可以私聊我，提供全套的解决方案包括源码。</p> <p>主要工具： node, express, node-xlsx, i18n</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/talking_blog/assets/js/app.5feee785.js" defer></script><script src="/talking_blog/assets/js/2.2bcc5ed6.js" defer></script><script src="/talking_blog/assets/js/11.a017f073.js" defer></script>
  </body>
</html>
